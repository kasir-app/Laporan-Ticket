<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Laporan Kerja</title>
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat ikon (Heroicons) -->
    <script type="module" src="https://unpkg.com/heroicons/dist/solid/index.js"></script>
    <script type="module" src="https://unpkg.com/heroicons/dist/outline/index.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        #pin-input { letter-spacing: 0.5em; font-family: monospace; }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Kontainer Login -->
    <div id="login-container" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-teal-300 p-4">
        <div class="bg-white p-8 md:p-12 rounded-2xl shadow-2xl w-full max-w-md">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-4">Laporan Kerja</h2>
            <p class="text-gray-600 text-center mb-8">Silakan login untuk melanjutkan</p>
            <form id="login-form">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="login-email" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="login-password" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="flex flex-col gap-4">
                    <button type="submit" id="login-button" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg hover:scale-105 transition-transform">Login</button>
                    <button type="button" id="register-button" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-lg hover:scale-105 transition-transform">Daftar Akun Baru</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Kontainer PIN Akses -->
    <div id="pin-container" class="hidden min-h-screen flex flex-col items-center justify-center bg-gray-900 p-4 z-50">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-xs text-center transform transition-all scale-100">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4">
                <svg class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Keamanan</h2>
            <p class="text-sm text-gray-500 mb-6">Masukkan PIN Akses untuk membuka aplikasi.</p>
            <form id="pin-form">
                <input type="password" id="pin-input" maxlength="6" class="w-full text-center text-3xl border-b-2 border-gray-300 focus:border-blue-500 outline-none py-2 mb-2 bg-transparent transition-colors" placeholder="••••••" required autofocus>
                <p id="pin-error" class="text-red-500 text-xs font-bold mb-6 h-4 hidden">PIN Salah! Coba lagi.</p>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-transform active:scale-95">Buka Kunci</button>
            </form>
            <button id="pin-logout-btn" class="mt-6 text-sm text-gray-400 hover:text-gray-600 underline">Bukan akun Anda? Logout</button>
        </div>
    </div>

    <!-- Kontainer Aplikasi Utama -->
    <div id="app-container" class="hidden flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-gradient-to-b from-blue-500 to-teal-500 text-white flex flex-col no-scrollbar overflow-y-auto shadow-lg">
            <div class="p-6 text-center border-b border-blue-400">
                <h1 class="text-2xl font-bold">Laporan Kerja</h1>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <a href="#" data-view="dashboard" class="sidebar-link active flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg><span>Dashboard</span></a>
                <a href="#" data-view="input-ticket" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg><span>Input Ticket</span></a>
                <a href="#" data-view="laporan-ticket" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg><span>Laporan Ticket</span></a>
                <a href="#" data-view="maintenance" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg><span>Maintenance</span></a>
                <a href="#" data-view="konfirm-customer" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-2.372M17 20v-2m0 2H5a2 2 0 01-2-2V7a2 2 0 012-2h3.172a1 1 0 01.707.293l1.414 1.414a1 1 0 00.707.293H21a2 2 0 012 2v2m-6 6v-6m0 6H9.343a1 1 0 01-.707-.293l-2.646-2.647a1 1 0 010-1.414l2.646-2.647a1 1 0 01.707-.293H17" /></svg><span>Konfirm Customer</span></a>
                <a href="#" data-view="kendala-vendor" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><span>Kendala Vendor</span></a>
                <a href="#" data-view="absensi" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg><span>Absensi</span></a>
                <a href="#" data-view="tools" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065zM15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg><span>Tools</span></a>
                <a href="#" data-view="cuty" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><span>Cuty</span></a>
                <a href="#" data-view="optional" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2v2m0-2h2m-2 0H8m4 10v2m0-2v-2m0 2H8m4 0h2m-2-4v2m0-2V8m0 2H8m4 0h2" /></svg><span>Optional</span></a>
            </nav>
            <div class="p-4 mt-auto border-t border-blue-400">
                <button id="logout-button" class="w-full flex items-center justify-center space-x-2 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg hover:scale-105 transition-transform"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" /></svg><span>Logout</span></button>
            </div>
        </aside>

        <!-- Konten Utama -->
        <main class="flex-1 bg-gray-100 p-6 md:p-10 overflow-y-auto no-scrollbar">
            <!-- Dashboard -->
            <div id="view-dashboard" class="content-view">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Dashboard</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div onclick="navigateTo('laporan-ticket')" class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer border-l-4 border-blue-500"><div class="flex items-center justify-between"><div><h3 class="font-semibold text-gray-700">Total Tiket</h3><p id="dashboard-ticket-count" class="text-3xl font-bold text-blue-600 mt-2">0</p></div><div class="p-3 bg-blue-100 rounded-full text-blue-600"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg></div></div></div>
                    <div onclick="navigateTo('maintenance')" class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer border-l-4 border-teal-500"><div class="flex items-center justify-between"><div><h3 class="font-semibold text-gray-700">Maintenance</h3><p id="dashboard-maintenance-count" class="text-3xl font-bold text-teal-600 mt-2">0</p></div><div class="p-3 bg-teal-100 rounded-full text-teal-600"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/></svg></div></div></div>
                    <div onclick="navigateTo('konfirm-customer')" class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer border-l-4 border-green-500"><div class="flex items-center justify-between"><div><h3 class="font-semibold text-gray-700">Konfirm Customer</h3><p id="dashboard-konfirm-count" class="text-3xl font-bold text-green-600 mt-2">0</p></div><div class="p-3 bg-green-100 rounded-full text-green-600"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-2.372M17 20v-2m0 2H5a2 2 0 01-2-2V7a2 2 0 012-2h3.172a1 1 0 01.707.293l1.414 1.414a1 1 0 00.707.293H21a2 2 0 012 2v2m-6 6v-6m0 6H9.343a1 1 0 01-.707-.293l-2.646-2.647a1 1 0 010-1.414l2.646-2.647a1 1 0 01.707-.293H17"/></svg></div></div></div>
                    <!-- Other dashboard cards omitted for brevity -->
                </div>
            </div>

            <!-- Input Ticket -->
            <div id="view-input-ticket" class="content-view hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Input Ticket Baru</h2>
                <form id="form-input-ticket" class="bg-white p-8 rounded-lg shadow-md space-y-6">
                    <div><label class="block text-sm font-medium text-gray-700">Nomer Ticket</label><input type="text" id="ticket-nomer" class="mt-1 w-full px-4 py-2 border rounded-lg" required></div>
                    <div><label class="block text-sm font-medium text-gray-700">Nama Branch</label><select id="ticket-branch" class="mt-1 w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Branch</option><option value="Branch Ciracas">Branch Ciracas</option><option value="Branch Cawang">Branch Cawang</option><option value="Branch Duren Sawit">Branch Duren Sawit</option><option value="Branch Rawamangun">Branch Rawamangun</option><option value="Branch Ujung Menteng">Branch Ujung Menteng</option><option value="Branch Pondok Kopi">Branch Pondok Kopi</option><option value="Branch Sunter">Branch Sunter</option><option value="Branch Pademangan">Branch Pademangan</option><option value="Branch PLuit">Branch PLuit</option><option value="Branch Kelapa Gading">Branch Kelapa Gading</option><option value="Branch Tanjung Priuk">Branch Tanjung Priuk</option></select></div>
                    <div><label class="block text-sm font-medium text-gray-700">Judul Ticket</label><select id="ticket-judul" class="mt-1 w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Kategori Ticket</option><option value="Internet Down">Internet Down</option><option value="Internet Slow">Internet Slow</option><option value="Internet Intermiten">Internet Intermiten</option><option value="Internal Customer Problem">Internal Customer Problem</option><option value="Kendala Deactivated">Kendala Deactivated</option><option value="Double Ticket">Double Ticket</option><option value="Optional">Optional</option></select></div>
                    <div><label class="block text-sm font-medium text-gray-700">Deskripsi</label><textarea id="ticket-deskripsi" rows="4" class="mt-1 w-full px-4 py-2 border rounded-lg" required></textarea></div>
                    <div><label class="block text-sm font-medium text-gray-700">Lampiran</label><input type="file" id="ticket-file" class="mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-blue-50 file:text-blue-700"><p id="ticket-upload-status" class="text-sm text-gray-500 mt-2"></p></div>
                    <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">Submit Ticket</button>
                </form>
            </div>

            <!-- Laporan Ticket -->
            <div id="view-laporan-ticket" class="content-view hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Laporan Ticket</h2>
                <div class="bg-white p-4 rounded-lg shadow-md mb-6 flex flex-col md:flex-row gap-4 items-end">
                    <div class="w-full md:w-auto"><label class="block text-sm font-medium text-gray-700 mb-1">Dari</label><input type="date" id="export-start-tickets" class="w-full border rounded px-3 py-2" onchange="applyFilter('tickets')"></div>
                    <div class="w-full md:w-auto"><label class="block text-sm font-medium text-gray-700 mb-1">Sampai</label><input type="date" id="export-end-tickets" class="w-full border rounded px-3 py-2" onchange="applyFilter('tickets')"></div>
                    <div class="w-full md:w-auto"><label class="block text-sm font-medium text-gray-700 mb-1">Branch</label><select id="export-branch-tickets" class="w-full border rounded px-3 py-2" onchange="applyFilter('tickets')"><option value="">Semua Branch</option></select></div>
                    <button onclick="handleExport('tickets')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded shadow">Download Excel</button>
                </div>
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center"><label class="text-sm text-gray-700 mr-2">Tampilkan</label><select onchange="changePageSize('tickets', this.value)" class="border rounded p-1"><option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select><label class="text-sm text-gray-700 ml-2">data</label></div>
                    <div class="flex items-center space-x-2"><button onclick="changePage('tickets', -1)" class="px-3 py-1 bg-gray-200 rounded text-sm">Prev</button><span id="page-indicator-tickets" class="text-sm font-medium">Page 1</span><button onclick="changePage('tickets', 1)" class="px-3 py-1 bg-gray-200 rounded text-sm">Next</button></div>
                </div>
                <div class="bg-white rounded-lg shadow-md overflow-hidden overflow-x-auto"><table class="w-full table-auto"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left">No Ticket</th><th class="px-6 py-3 text-left">Branch</th><th class="px-6 py-3 text-left">Judul</th><th class="px-6 py-3 text-left">Deskripsi</th><th class="px-6 py-3 text-left">Lampiran</th><th class="px-6 py-3 text-left">Status</th><th class="px-6 py-3 text-left">Tanggal</th><th class="px-6 py-3 text-left">Aksi</th></tr></thead><tbody id="report-container-ticket" class="bg-white divide-y divide-gray-200"></tbody></table></div>
            </div>

            <!-- Maintenance -->
            <div id="view-maintenance" class="content-view hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Input & Laporan Maintenance</h2>
                <form id="form-maintenance" class="bg-white p-8 rounded-lg shadow-md space-y-6 mb-8">
                     <div><label class="block text-sm font-medium text-gray-700">Nama Branch</label><select id="maintenance-branch" class="mt-1 w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Branch</option><option value="Branch Ciracas">Branch Ciracas</option><option value="Branch Cawang">Branch Cawang</option><option value="Branch Duren Sawit">Branch Duren Sawit</option><option value="Branch Rawamangun">Branch Rawamangun</option><option value="Branch Ujung Menteng">Branch Ujung Menteng</option><option value="Branch Pondok Kopi">Branch Pondok Kopi</option><option value="Branch Sunter">Branch Sunter</option><option value="Branch Pademangan">Branch Pademangan</option><option value="Branch PLuit">Branch PLuit</option><option value="Branch Kelapa Gading">Branch Kelapa Gading</option><option value="Branch Tanjung Priuk">Branch Tanjung Priuk</option></select></div>
                    <input type="text" id="maintenance-judul" placeholder="Judul Maintenance" class="w-full px-4 py-2 border rounded-lg" required>
                    <textarea id="maintenance-deskripsi" rows="4" placeholder="Deskripsi" class="w-full px-4 py-2 border rounded-lg" required></textarea>
                    <button type="submit" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-4 rounded-lg">Submit Maintenance</button>
                </form>
                <div class="bg-white p-4 rounded-lg shadow-md mb-6 flex flex-col md:flex-row gap-4 items-end">
                    <div class="w-full md:w-auto"><label class="block text-sm font-medium text-gray-700 mb-1">Dari</label><input type="date" id="export-start-maintenance" class="w-full border rounded px-3 py-2" onchange="applyFilter('maintenance')"></div>
                    <div class="w-full md:w-auto"><label class="block text-sm font-medium text-gray-700 mb-1">Sampai</label><input type="date" id="export-end-maintenance" class="w-full border rounded px-3 py-2" onchange="applyFilter('maintenance')"></div>
                    <div class="w-full md:w-auto"><label class="block text-sm font-medium text-gray-700 mb-1">Branch</label><select id="export-branch-maintenance" class="w-full border rounded px-3 py-2" onchange="applyFilter('maintenance')"><option value="">Semua Branch</option></select></div>
                    <button onclick="handleExport('maintenance')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded shadow">Download Excel</button>
                </div>
                <div class="flex justify-between items-center mb-4"><div class="flex items-center"><label class="text-sm text-gray-700 mr-2">Tampilkan</label><select onchange="changePageSize('maintenance', this.value)" class="border rounded p-1"><option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select><label class="text-sm text-gray-700 ml-2">data</label></div><div class="flex items-center space-x-2"><button onclick="changePage('maintenance', -1)" class="px-3 py-1 bg-gray-200 rounded text-sm">Prev</button><span id="page-indicator-maintenance" class="text-sm font-medium">Page 1</span><button onclick="changePage('maintenance', 1)" class="px-3 py-1 bg-gray-200 rounded text-sm">Next</button></div></div>
                <div class="bg-white rounded-lg shadow-md overflow-hidden overflow-x-auto"><table class="w-full table-auto"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left">Branch</th><th class="px-6 py-3 text-left">Judul</th><th class="px-6 py-3 text-left">Deskripsi</th><th class="px-6 py-3 text-left">Tanggal</th></tr></thead><tbody id="report-container-maintenance" class="bg-white divide-y divide-gray-200"></tbody></table></div>
            </div>

            <!-- Konfirm Customer -->
            <div id="view-konfirm-customer" class="content-view hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Input & Laporan Konfirmasi Customer</h2>
                <form id="form-konfirm-customer" class="bg-white p-8 rounded-lg shadow-md space-y-6 mb-8">
                     <select id="konfirm-branch" class="w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Branch</option><option value="Branch Ciracas">Branch Ciracas</option><option value="Branch Cawang">Branch Cawang</option><option value="Branch Duren Sawit">Branch Duren Sawit</option><option value="Branch Rawamangun">Branch Rawamangun</option><option value="Branch Ujung Menteng">Branch Ujung Menteng</option><option value="Branch Pondok Kopi">Branch Pondok Kopi</option><option value="Branch Sunter">Branch Sunter</option><option value="Branch Pademangan">Branch Pademangan</option><option value="Branch PLuit">Branch PLuit</option><option value="Branch Kelapa Gading">Branch Kelapa Gading</option><option value="Branch Tanjung Priuk">Branch Tanjung Priuk</option></select>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Tanggal Input</label><input type="date" id="konfirm-tanggal" class="w-full px-4 py-2 border rounded-lg" required></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Judul</label><select id="konfirm-judul" class="w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Judul</option><option value="Internet Down">Internet Down</option><option value="Internet Slow">Internet Slow</option><option value="Internet Intermiten">Internet Intermiten</option><option value="Internal Customer Problem">Internal Customer Problem</option><option value="Kendala Deactivated">Kendala Deactivated</option><option value="Double Ticket">Double Ticket</option><option value="Optional">Optional</option></select></div>
                    <textarea id="konfirm-deskripsi" rows="4" placeholder="Deskripsi" class="w-full px-4 py-2 border rounded-lg" required></textarea>
                    <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">Submit</button>
                </form>
                <div class="bg-white p-4 rounded-lg shadow-md mb-6 flex flex-col md:flex-row gap-4 items-end">
                    <div class="w-full md:w-auto"><label class="block text-sm font-medium text-gray-700 mb-1">Dari</label><input type="date" id="export-start-konfirmCustomer" class="w-full border rounded px-3 py-2" onchange="applyFilter('konfirmCustomer')"></div>
                    <div class="w-full md:w-auto"><label class="block text-sm font-medium text-gray-700 mb-1">Sampai</label><input type="date" id="export-end-konfirmCustomer" class="w-full border rounded px-3 py-2" onchange="applyFilter('konfirmCustomer')"></div>
                    <div class="w-full md:w-auto"><label class="block text-sm font-medium text-gray-700 mb-1">Branch</label><select id="export-branch-konfirmCustomer" class="w-full border rounded px-3 py-2" onchange="applyFilter('konfirmCustomer')"><option value="">Semua Branch</option></select></div>
                    <button onclick="handleExport('konfirmCustomer')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded shadow">Download Excel</button>
                </div>
                <div class="flex justify-between items-center mb-4"><div class="flex items-center"><label class="text-sm text-gray-700 mr-2">Tampilkan</label><select onchange="changePageSize('konfirmCustomer', this.value)" class="border rounded p-1"><option value="5">5</option><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select><label class="text-sm text-gray-700 ml-2">data</label></div><div class="flex items-center space-x-2"><button onclick="changePage('konfirmCustomer', -1)" class="px-3 py-1 bg-gray-200 rounded text-sm">Prev</button><span id="page-indicator-konfirmCustomer" class="text-sm font-medium">Page 1</span><button onclick="changePage('konfirmCustomer', 1)" class="px-3 py-1 bg-gray-200 rounded text-sm">Next</button></div></div>
                <div class="bg-white rounded-lg shadow-md overflow-hidden overflow-x-auto"><table class="w-full table-auto"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left">Branch</th><th class="px-6 py-3 text-left">Tgl Input</th><th class="px-6 py-3 text-left">Judul</th><th class="px-6 py-3 text-left">Deskripsi</th><th class="px-6 py-3 text-left">Status</th><th class="px-6 py-3 text-left">Dibuat</th><th class="px-6 py-3 text-left">Aksi</th></tr></thead><tbody id="report-container-konfirm-customer" class="divide-y divide-gray-200"></tbody></table></div>
            </div>

            <!-- Other Views -->
            <div id="view-kendala-vendor" class="content-view hidden"><h2 class="text-3xl font-bold">Kendala Vendor</h2><!-- ... --></div>
            <div id="view-absensi" class="content-view hidden"><h2 class="text-3xl font-bold">Absensi</h2><!-- ... --></div>
            <div id="view-tools" class="content-view hidden"><h2 class="text-3xl font-bold">Tools</h2><!-- ... --></div>
            <div id="view-cuty" class="content-view hidden"><h2 class="text-3xl font-bold">Cuty</h2><!-- ... --></div>
            <div id="view-optional" class="content-view hidden"><h2 class="text-3xl font-bold">Optional</h2><!-- ... --></div>
        </main>
    </div>

    <!-- Modals -->
    <div id="alert-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center"><div class="relative p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3 text-center"><h3 class="text-lg font-medium" id="alert-title"></h3><div class="mt-2 px-7 py-3"><p class="text-sm text-gray-500" id="alert-message"></p></div><div class="px-4 py-3"><button id="alert-ok-button" class="px-4 py-2 bg-blue-500 text-white rounded-md w-full">OK</button></div></div></div></div>
    <div id="confirm-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center"><div class="relative p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3 text-center"><h3 class="text-lg font-medium text-red-600">Konfirmasi</h3><div class="mt-2 px-7 py-3"><p class="text-sm text-gray-500">Hapus data ini?</p></div><div class="flex gap-4 px-4 py-3 justify-center"><button id="confirm-cancel-button" class="px-4 py-2 bg-gray-300 rounded-md">Batal</button><button id="confirm-delete-button" class="px-4 py-2 bg-red-600 text-white rounded-md">Hapus</button></div></div></div></div>
    <div id="edit-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full z-50 flex items-center justify-center"><div class="relative bg-white rounded-lg shadow-xl w-full max-w-lg mx-4"><div class="px-6 py-4 border-b flex justify-between"><h3 class="text-lg font-bold">Edit Data</h3><button onclick="closeEditModal()">x</button></div><div class="p-6 space-y-4" id="edit-modal-content"></div><div class="px-6 py-4 bg-gray-50 flex justify-end gap-3"><button onclick="closeEditModal()" class="px-4 py-2 border rounded-lg">Batal</button><button id="save-edit-button" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Simpan</button></div></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, signInWithCustomToken, setPersistence, inMemoryPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, Timestamp, setLogLevel, deleteDoc, updateDoc, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // CONFIG FIREBASE (HARDCODED)
        const firebaseConfigFromUser = { apiKey: "AIzaSyAsHgpBDdNRIWnAAV7X8mxaF7C23KsOgsg", authDomain: "report-netop-jak-5.firebaseapp.com", projectId: "report-netop-jak-5", storageBucket: "report-netop-jak-5.firebasestorage.app", messagingSenderId: "254034468445", appId: "1:254034468445:web:e2b24dd61fae05a13df7b4", measurementId: "G-ERDCLK8NEN" };
        const firebaseConfig = firebaseConfigFromUser; 
        const appId = firebaseConfig.projectId;

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        setLogLevel('Debug');

        let userId = null, unsubscribeListeners = [], itemToDelete = null, itemToEdit = null;
        window.appData = {};
        window.paginationState = { tickets: {page:1,limit:5}, maintenance: {page:1,limit:5}, konfirmCustomer: {page:1,limit:5}, kendalaVendor: {page:1,limit:5}, absensi: {page:1,limit:5}, tools: {page:1,limit:5}, cuty: {page:1,limit:5}, optional: {page:1,limit:5} };

        const loginContainer=document.getElementById('login-container'), pinContainer=document.getElementById('pin-container'), appContainer=document.getElementById('app-container'), alertModal=document.getElementById('alert-modal'), confirmModal=document.getElementById('confirm-modal'), editModal=document.getElementById('edit-modal');
        function showAlert(msg, title="Notifikasi") { document.getElementById('alert-title').innerText=title; document.getElementById('alert-message').innerText=msg; alertModal.classList.remove('hidden'); }
        document.getElementById('alert-ok-button').addEventListener('click', () => alertModal.classList.add('hidden'));

        // PIN & Auth
        document.getElementById('pin-form').addEventListener('submit', (e) => { e.preventDefault(); if(document.getElementById('pin-input').value==="122025"){ sessionStorage.setItem('pin_verified','true'); pinContainer.classList.add('hidden'); appContainer.classList.remove('hidden'); initApp(); } else { document.getElementById('pin-error').classList.remove('hidden'); } });
        document.getElementById('pin-logout-btn').addEventListener('click', async()=>{ await signOut(auth); pinContainer.classList.add('hidden'); loginContainer.classList.remove('hidden'); sessionStorage.removeItem('pin_verified'); });
        onAuthStateChanged(auth, (user) => { if(user){ userId=user.uid; loginContainer.classList.add('hidden'); if(sessionStorage.getItem('pin_verified')==='true'){ appContainer.classList.remove('hidden'); initApp(); } else { pinContainer.classList.remove('hidden'); } } else { userId=null; loginContainer.classList.remove('hidden'); appContainer.classList.add('hidden'); pinContainer.classList.add('hidden'); stopFirestoreListeners(); } });
        document.getElementById('login-form').addEventListener('submit', async(e)=>{e.preventDefault(); try{await signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-password').value);}catch(e){showAlert(e.message);}});
        document.getElementById('logout-button').addEventListener('click', ()=>{sessionStorage.removeItem('pin_verified'); signOut(auth);});

        // Navigation
        window.navigateTo = function(v){ document.querySelectorAll('.sidebar-link').forEach(l=>{l.classList.remove('active','bg-blue-700'); if(l.dataset.view===v)l.classList.add('active','bg-blue-700');}); document.querySelectorAll('.content-view').forEach(c=>c.classList.add('hidden')); document.getElementById(`view-${v}`).classList.remove('hidden'); };
        document.querySelectorAll('.sidebar-link').forEach(l=>l.addEventListener('click',(e)=>{e.preventDefault(); navigateTo(l.dataset.view);}));

        // Main App Logic
        function initApp() {
            if (!userId) return;
            stopFirestoreListeners();
            setupFormAndReport('input-ticket', 'tickets', renderTicketReport, handleSubmitTicket);
            setupFormAndReport('konfirm-customer', 'konfirmCustomer', renderKonfirmCustomerReport, createGenericSubmitHandler('konfirmCustomer'));
            setupFormAndReport('maintenance', 'maintenance', renderMaintenanceReport, handleSubmitMaintenance);
            setupDashboardListeners();
        }

        function stopFirestoreListeners() { unsubscribeListeners.forEach(u=>u()); unsubscribeListeners=[]; }

        function setupFormAndReport(view, col, render, submit) {
            const form = document.getElementById(`form-${view}`);
            if(form) form.onsubmit = (e)=>{e.preventDefault(); submit(e);};
            const cid = view==='input-ticket'?'report-container-ticket':`report-container-${view.replace('input-', '')}`;
            const container = document.getElementById(cid);
            if(container) {
                const q = query(collection(db, `artifacts/${appId}/users/${userId}/${col}`));
                unsubscribeListeners.push(onSnapshot(q, (s) => {
                    const data = []; s.forEach(d => data.push({id: d.id, ...d.data()}));
                    if(data.length>0 && data[0].createdAt) data.sort((a,b)=>b.createdAt.toMillis()-a.createdAt.toMillis());
                    window.appData[col] = data;
                    populateBranchFilter(col, data);
                    refreshTable(col);
                }));
            }
        }

        // --- FILTER LOGIC ---
        function populateBranchFilter(col, data) {
            const select = document.getElementById(`export-branch-${col}`);
            if (!select) return;
            const currentVal = select.value;
            const branches = [...new Set(data.map(item => item.branch ? item.branch.trim() : ""))].filter(b => b).sort();
            
            select.innerHTML = '<option value="">Semua Branch</option>';
            branches.forEach(branch => {
                const opt = document.createElement('option');
                opt.value = branch; opt.textContent = branch;
                select.appendChild(opt);
            });
            if (branches.includes(currentVal)) select.value = currentVal;
        }

        window.applyFilter = function(col) {
            window.paginationState[col].page = 1;
            refreshTable(col);
        }

        function getFilteredData(col) {
            const rawData = window.appData[col] || [];
            const startEl = document.getElementById(`export-start-${col}`);
            const endEl = document.getElementById(`export-end-${col}`);
            const branchEl = document.getElementById(`export-branch-${col}`);
            
            const startVal = startEl ? startEl.value : null;
            const endVal = endEl ? endEl.value : null;
            const branchVal = branchEl ? branchEl.value : null;

            return rawData.filter(item => {
                let valid = true;
                if (item.createdAt) {
                    const date = item.createdAt.toDate();
                    date.setHours(0,0,0,0);
                    if (startVal && date < new Date(startVal).setHours(0,0,0,0)) valid = false;
                    if (endVal && date > new Date(endVal).setHours(23,59,59,999)) valid = false;
                }
                if (branchVal && branchVal !== "") {
                    const itemBranch = item.branch ? item.branch.trim() : "";
                    if (itemBranch !== branchVal) valid = false;
                }
                return valid;
            });
        }

        window.changePageSize = function(col, val) { window.paginationState[col].limit = parseInt(val); window.paginationState[col].page = 1; refreshTable(col); };
        window.changePage = function(col, d) { 
            const data = getFilteredData(col);
            const s = window.paginationState[col], total = Math.ceil(data.length/s.limit);
            if(s.page+d > 0 && s.page+d <= total) { s.page += d; refreshTable(col); }
        };

        function refreshTable(col) { 
            const cid = col==='tickets'?'report-container-ticket':col==='konfirmCustomer'?'report-container-konfirm-customer':`report-container-${col}`;
            const container = document.getElementById(cid);
            const renderFn = col==='tickets'?renderTicketReport:col==='konfirmCustomer'?renderKonfirmCustomerReport:renderMaintenanceReport;
            
            const filteredData = getFilteredData(col);
            const s = window.paginationState[col];
            
            const start = (s.page - 1) * s.limit;
            const end = start + s.limit;
            const paginatedData = filteredData.slice(start, end);
            
            const totalPages = Math.ceil(filteredData.length / s.limit) || 1;
            const indicator = document.getElementById(`page-indicator-${col}`);
            if(indicator) indicator.innerText = `Page ${s.page} of ${totalPages}`;

            renderFn(container, paginatedData);
        }

        // --- NEW EXCEL EXPORT (HTML TABLE BASED) ---
        window.handleExport = function(col) {
            const data = getFilteredData(col);
            if(data.length === 0) return showAlert("Tidak ada data untuk di-download.");

            // 1. Define Headers
            const headerMap = { 'createdAt': 'Tanggal', 'status': 'Status', 'branch': 'Branch', 'nomer': 'No Ticket', 'judul': 'Judul', 'deskripsi': 'Deskripsi', 'fileUrl': 'Link File', 'tanggal': 'Tgl Input', 'keterangan': 'Keterangan', 'nama': 'Nama Tool', 'mulai': 'Mulai', 'selesai': 'Selesai', 'alasan': 'Alasan' };
            const firstItem = data[0];
            const allKeys = Object.keys(firstItem).filter(k => !['id', 'storagePath'].includes(k));
            
            const orderedKeys = [];
            if(allKeys.includes('nomer')) orderedKeys.push('nomer');
            if(allKeys.includes('branch')) orderedKeys.push('branch');
            if(allKeys.includes('tanggal')) orderedKeys.push('tanggal');
            if(allKeys.includes('createdAt')) orderedKeys.push('createdAt');
            if(allKeys.includes('status')) orderedKeys.push('status');
            allKeys.forEach(k => { if(!orderedKeys.includes(k) && k !== 'fileUrl') orderedKeys.push(k); });
            if(allKeys.includes('fileUrl')) orderedKeys.push('fileUrl');

            // 2. Build HTML Table
            let table = `<table border="1"><thead><tr>`;
            orderedKeys.forEach(key => { table += `<th>${headerMap[key] || key.charAt(0).toUpperCase() + key.slice(1)}</th>`; });
            table += `</tr></thead><tbody>`;

            data.forEach(item => {
                table += `<tr>`;
                orderedKeys.forEach(key => {
                    let val = item[key] || '';
                    if (key === 'createdAt' && val && val.toDate) val = val.toDate().toLocaleString('id-ID');
                    else if (key === 'fileUrl' && val) val = `<a href="${val}" target="_blank">Lihat File</a>`;
                    if (typeof val === 'string' && key !== 'fileUrl') val = val.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    table += `<td>${val}</td>`;
                });
                table += `</tr>`;
            });
            table += `</tbody></table>`;

            // 3. Create XLS File
            const excelTemplate = `<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="UTF-8"></head><body>${table}</body></html>`;
            const blob = new Blob([excelTemplate], { type: 'application/vnd.ms-excel' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `Laporan_${col}_${new Date().toISOString().slice(0,10)}.xls`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // Handlers
        async function handleSubmitTicket(e) { handleGenericSubmit(e, 'tickets', async (form) => { const f=form.querySelector('#ticket-file').files[0]; let u=null; if(f){const r=await uploadBytes(ref(storage,`artifacts/${appId}/users/${userId}/tickets/${Date.now()}_${f.name}`),f);u=await getDownloadURL(r.ref);} return {nomer:form.querySelector('#ticket-nomer').value, branch:form.querySelector('#ticket-branch').value, judul:form.querySelector('#ticket-judul').value, deskripsi:form.querySelector('#ticket-deskripsi').value, status:'Open', fileUrl:u}; }); }
        async function handleSubmitMaintenance(e) { handleGenericSubmit(e, 'maintenance', f => ({branch:f.querySelector('#maintenance-branch').value, judul:f.querySelector('#maintenance-judul').value, deskripsi:f.querySelector('#maintenance-deskripsi').value})); }
        function createGenericSubmitHandler(col) { return (e) => handleGenericSubmit(e, col, f => { const d={status:'Open'}; f.querySelectorAll('input:not([type=file]),textarea,select').forEach(i=>{if(i.id)d[i.id.split('-').slice(1).join('-')]=i.value;}); return d; }); }
        async function handleGenericSubmit(e, col, extractor) { const btn=e.target.querySelector('button[type=submit]'); btn.disabled=true; try{ const d=await extractor(e.target); await addDoc(collection(db,`artifacts/${appId}/users/${userId}/${col}`),{...d,createdAt:Timestamp.now()}); showAlert("Berhasil!"); e.target.reset(); }catch(e){showAlert(e.message);}finally{btn.disabled=false;} }

        function getStatusBadge(s) { const c={'Done':'bg-green-100 text-green-800','Reschedule':'bg-yellow-100 text-yellow-800','Open':'bg-gray-100 text-gray-800'}; return `<span class="px-2 text-xs font-semibold rounded-full ${c[s]||c['Open']}">${s||'Open'}</span>`; }
        function getActionButtons(col, id) { return `<div class="flex space-x-2"><button onclick="openEditModal('${col}','${id}')" class="text-indigo-600">Edit</button><button onclick="confirmDelete('${col}','${id}')" class="text-red-600">Hapus</button></div>`; }

        function renderTicketReport(c, d) { if(d.length===0)return c.innerHTML=`<tr><td colspan="8" class="text-center py-4 text-gray-500">Tidak ada data.</td></tr>`; c.innerHTML=d.map(t=>`<tr class="hover:bg-gray-50"><td class="px-6 py-4 font-semibold">${t.nomer||'-'}</td><td class="px-6 py-4">${t.branch}</td><td class="px-6 py-4">${t.judul}</td><td class="px-6 py-4"><textarea readonly rows="2" class="w-full bg-gray-50 rounded">${t.deskripsi}</textarea></td><td class="px-6 py-4">${t.fileUrl?`<a href="${t.fileUrl}" target="_blank" class="text-blue-500">Lihat</a>`:'-'}</td><td class="px-6 py-4">${getStatusBadge(t.status)}</td><td class="px-6 py-4">${t.createdAt?.toDate().toLocaleDateString()}</td><td class="px-6 py-4">${getActionButtons('tickets',t.id)}</td></tr>`).join(''); }
        function renderKonfirmCustomerReport(c, d) { if(d.length===0)return c.innerHTML=`<tr><td colspan="7" class="text-center py-4 text-gray-500">Tidak ada data.</td></tr>`; c.innerHTML=d.map(t=>`<tr class="hover:bg-gray-50"><td class="px-6 py-4">${t.branch}</td><td class="px-6 py-4">${t.tanggal}</td><td class="px-6 py-4">${t.judul}</td><td class="px-6 py-4"><textarea readonly rows="2" class="w-full bg-gray-50 rounded">${t.deskripsi}</textarea></td><td class="px-6 py-4">${getStatusBadge(t.status)}</td><td class="px-6 py-4">${t.createdAt?.toDate().toLocaleDateString()}</td><td class="px-6 py-4">${getActionButtons('konfirmCustomer',t.id)}</td></tr>`).join(''); }
        function renderMaintenanceReport(c, d) { if(d.length===0)return c.innerHTML=`<tr><td colspan="4" class="text-center">No Data</td></tr>`; c.innerHTML=d.map(t=>`<tr class="hover:bg-gray-50"><td class="px-6 py-4">${t.branch}</td><td class="px-6 py-4">${t.judul}</td><td class="px-6 py-4 text-gray-500">${t.deskripsi}</td><td class="px-6 py-4">${t.createdAt?.toDate().toLocaleDateString()}</td></tr>`).join(''); }

        function setupDashboardListeners() { if(!userId)return; const map={'tickets':'dashboard-ticket-count','maintenance':'dashboard-maintenance-count','konfirmCustomer':'dashboard-konfirm-count','kendalaVendor':'dashboard-kendala-count','absensi':'dashboard-absensi-count'}; for(const[c,i] of Object.entries(map)){ const el=document.getElementById(i); if(el) unsubscribeListeners.push(onSnapshot(query(collection(db,`artifacts/${appId}/users/${userId}/${c}`)), s=>el.innerText=s.size)); } }
        
        window.confirmDelete = function(c,i){itemToDelete={collection:c,id:i};confirmModal.classList.remove('hidden');}
        document.getElementById('confirm-cancel-button').onclick=()=>confirmModal.classList.add('hidden');
        document.getElementById('confirm-delete-button').onclick=async()=>{if(itemToDelete){await deleteDoc(doc(db,`artifacts/${appId}/users/${userId}/${itemToDelete.collection}`,itemToDelete.id));confirmModal.classList.add('hidden');showAlert("Dihapus");}};
        
        window.openEditModal = function(col, id) { const d = window.appData[col].find(i=>i.id===id); if(!d)return; itemToEdit={col,id}; const c=document.getElementById('edit-modal-content'); 
            let html=`Status: <select id="edit-status" class="border p-1 w-full"><option>Open</option><option>Done</option><option>Reschedule</option></select><br>`;
            if (col==='konfirmCustomer') html += `Tanggal: <input type="date" id="edit-date" class="border p-1 w-full" value="${d.tanggal}"><br>`;
            html += `Deskripsi: <textarea id="edit-desc" class="border p-1 w-full mt-2">${d.deskripsi}</textarea>`; 
            c.innerHTML=html; 
            document.getElementById('edit-status').value=d.status||'Open'; 
            editModal.classList.remove('hidden'); 
        };
        window.closeEditModal = function(){editModal.classList.add('hidden');};
        document.getElementById('save-edit-button').onclick=async()=>{if(itemToEdit){
            const updates = {status:document.getElementById('edit-status').value,deskripsi:document.getElementById('edit-desc').value};
            if(document.getElementById('edit-date')) updates.tanggal = document.getElementById('edit-date').value;
            await updateDoc(doc(db,`artifacts/${appId}/users/${userId}/${itemToEdit.col}`,itemToEdit.id), updates);
            closeEditModal();showAlert("Tersimpan");
        }};
    </script>
</body>
</html>