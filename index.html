<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Laporan Kerja</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/heroicons/dist/solid/index.js"></script>
    <script type="module" src="https://unpkg.com/heroicons/dist/outline/index.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        #pin-input { letter-spacing: 0.5em; font-family: monospace; }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Login & PIN Containers (Sama seperti sebelumnya) -->
    <div id="login-container" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-teal-300 p-4">
        <div class="bg-white p-8 md:p-12 rounded-2xl shadow-2xl w-full max-w-md">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-4">Laporan Kerja</h2>
            <form id="login-form">
                <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-1">Email</label><input type="email" id="login-email" class="w-full px-4 py-2 border rounded-lg" required></div>
                <div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-1">Password</label><input type="password" id="login-password" class="w-full px-4 py-2 border rounded-lg" required></div>
                <div class="flex flex-col gap-4"><button type="submit" id="login-button" class="w-full bg-blue-500 text-white font-bold py-2 px-4 rounded-lg shadow-lg hover:scale-105">Login</button><button type="button" id="register-button" class="w-full bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-lg hover:scale-105">Daftar Akun Baru</button></div>
            </form>
        </div>
    </div>

    <div id="pin-container" class="hidden min-h-screen flex flex-col items-center justify-center bg-gray-900 p-4 z-50">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-xs text-center">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4"><svg class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg></div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Keamanan</h2><p class="text-sm text-gray-500 mb-6">Masukkan PIN Akses.</p>
            <form id="pin-form"><input type="password" id="pin-input" maxlength="6" class="w-full text-center text-3xl border-b-2 border-gray-300 outline-none py-2 mb-2 bg-transparent" placeholder="••••••" required autofocus><p id="pin-error" class="text-red-500 text-xs font-bold mb-6 h-4 hidden">PIN Salah!</p><button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-md">Buka Kunci</button></form>
            <button id="pin-logout-btn" class="mt-6 text-sm text-gray-400 hover:text-gray-600 underline">Bukan akun Anda? Logout</button>
        </div>
    </div>

    <div id="app-container" class="hidden flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-gradient-to-b from-blue-500 to-teal-500 text-white flex flex-col no-scrollbar overflow-y-auto shadow-lg">
            <div class="p-6 text-center border-b border-blue-400"><h1 class="text-2xl font-bold">Laporan Kerja</h1></div>
            <nav class="flex-1 p-4 space-y-2">
                <a href="#" data-view="dashboard" class="sidebar-link active flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg><span>Dashboard</span></a>
                <a href="#" data-view="input-ticket" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg><span>Input Ticket</span></a>
                <a href="#" data-view="laporan-ticket" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg><span>Laporan Ticket</span></a>
                <a href="#" data-view="maintenance" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/></svg><span>Maintenance</span></a>
                <a href="#" data-view="konfirm-customer" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-2.372M17 20v-2m0 2H5a2 2 0 01-2-2V7a2 2 0 012-2h3.172a1 1 0 01.707.293l1.414 1.414a1 1 0 00.707.293H21a2 2 0 012 2v2m-6 6v-6m0 6H9.343a1 1 0 01-.707-.293l-2.646-2.647a1 1 0 010-1.414l2.646-2.647a1 1 0 01.707-.293H17"/></svg><span>Konfirm Customer</span></a>
                <a href="#" data-view="kendala-vendor" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Kendala Vendor</span></a>
                <a href="#" data-view="absensi" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Absensi</span></a>
                <a href="#" data-view="tools" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065zM15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg><span>Tools</span></a>
                <a href="#" data-view="cuty" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span>Cuty</span></a>
                <a href="#" data-view="optional" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2v2m0-2h2m-2 0H8m4 10v2m0-2v-2m0 2H8m4 0h2m-2-4v2m0-2V8m0 2H8m4 0h2"/></svg><span>Optional</span></a>
            </nav>
            <div class="p-4 mt-auto border-t border-blue-400"><button id="logout-button" class="w-full flex items-center justify-center space-x-2 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg hover:scale-105"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/></svg><span>Logout</span></button></div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 bg-gray-100 p-6 md:p-10 overflow-y-auto no-scrollbar">
            <!-- Dashboard -->
            <div id="view-dashboard" class="content-view">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Dashboard</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Cards -->
                    <div onclick="navigateTo('laporan-ticket')" class="bg-white p-6 rounded-lg shadow-md cursor-pointer border-l-4 border-blue-500 hover:-translate-y-1 transform transition"><div class="flex justify-between"><div><h3 class="font-semibold text-gray-700">Total Tiket</h3><p id="dashboard-ticket-count" class="text-3xl font-bold text-blue-600">0</p></div><div class="p-3 bg-blue-100 rounded-full text-blue-600"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg></div></div></div>
                    <div onclick="navigateTo('maintenance')" class="bg-white p-6 rounded-lg shadow-md cursor-pointer border-l-4 border-teal-500 hover:-translate-y-1 transform transition"><div class="flex justify-between"><div><h3 class="font-semibold text-gray-700">Maintenance</h3><p id="dashboard-maintenance-count" class="text-3xl font-bold text-teal-600">0</p></div><div class="p-3 bg-teal-100 rounded-full text-teal-600"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/></svg></div></div></div>
                    <div onclick="navigateTo('konfirm-customer')" class="bg-white p-6 rounded-lg shadow-md cursor-pointer border-l-4 border-green-500 hover:-translate-y-1 transform transition"><div class="flex justify-between"><div><h3 class="font-semibold text-gray-700">Konfirm Customer</h3><p id="dashboard-konfirm-count" class="text-3xl font-bold text-green-600">0</p></div><div class="p-3 bg-green-100 rounded-full text-green-600"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-2.372M17 20v-2m0 2H5a2 2 0 01-2-2V7a2 2 0 012-2h3.172a1 1 0 01.707.293l1.414 1.414a1 1 0 00.707.293H21a2 2 0 012 2v2m-6 6v-6m0 6H9.343a1 1 0 01-.707-.293l-2.646-2.647a1 1 0 010-1.414l2.646-2.647a1 1 0 01.707-.293H17"/></svg></div></div></div>
                    <div onclick="navigateTo('kendala-vendor')" class="bg-white p-6 rounded-lg shadow-md cursor-pointer border-l-4 border-yellow-500 hover:-translate-y-1 transform transition"><div class="flex justify-between"><div><h3 class="font-semibold text-gray-700">Kendala Vendor</h3><p id="dashboard-kendala-count" class="text-3xl font-bold text-yellow-600">0</p></div><div class="p-3 bg-yellow-100 rounded-full text-yellow-600"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div></div></div>
                    <div onclick="navigateTo('absensi')" class="bg-white p-6 rounded-lg shadow-md cursor-pointer border-l-4 border-indigo-500 hover:-translate-y-1 transform transition"><div class="flex justify-between"><div><h3 class="font-semibold text-gray-700">Absensi</h3><p id="dashboard-absensi-count" class="text-3xl font-bold text-indigo-600">0</p></div><div class="p-3 bg-indigo-100 rounded-full text-indigo-600"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg></div></div></div>
                    <div onclick="navigateTo('tools')" class="bg-white p-6 rounded-lg shadow-md cursor-pointer border-l-4 border-purple-500 hover:-translate-y-1 transform transition"><div class="flex justify-between"><div><h3 class="font-semibold text-gray-700">Tools</h3><p id="dashboard-tools-count" class="text-3xl font-bold text-purple-600">0</p></div><div class="p-3 bg-purple-100 rounded-full text-purple-600"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065zM15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg></div></div></div>
                    <div onclick="navigateTo('cuty')" class="bg-white p-6 rounded-lg shadow-md cursor-pointer border-l-4 border-pink-500 hover:-translate-y-1 transform transition"><div class="flex justify-between"><div><h3 class="font-semibold text-gray-700">Cuti</h3><p id="dashboard-cuty-count" class="text-3xl font-bold text-pink-600">0</p></div><div class="p-3 bg-pink-100 rounded-full text-pink-600"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div></div></div>
                    <div onclick="navigateTo('optional')" class="bg-white p-6 rounded-lg shadow-md cursor-pointer border-l-4 border-gray-500 hover:-translate-y-1 transform transition"><div class="flex justify-between"><div><h3 class="font-semibold text-gray-700">Optional</h3><p id="dashboard-optional-count" class="text-3xl font-bold text-gray-600">0</p></div><div class="p-3 bg-gray-100 rounded-full text-gray-600"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2v2m0-2h2m-2 0H8m4 10v2m0-2v-2m0 2H8m4 0h2m-2-4v2m0-2V8m0 2H8m4 0h2"/></svg></div></div></div>
                </div>
            </div>

            <!-- Input Ticket -->
            <div id="view-input-ticket" class="content-view hidden"><h2 class="text-3xl font-bold mb-6">Input Ticket Baru</h2><form id="form-input-ticket" class="bg-white p-8 rounded-lg shadow-md space-y-6"><div><label class="block text-sm font-medium">Nomer Ticket</label><input type="text" id="ticket-nomer" class="w-full px-4 py-2 border rounded-lg" required></div><div><label class="block text-sm font-medium">Branch</label><select id="ticket-branch" class="w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Branch</option><option>Branch Ciracas</option><option>Branch Cawang</option><option>Branch Duren Sawit</option><option>Branch Rawamangun</option><option>Branch Ujung Menteng</option><option>Branch Pondok Kopi</option><option>Branch Sunter</option><option>Branch Pademangan</option><option>Branch PLuit</option><option>Branch Kelapa Gading</option><option>Branch Tanjung Priuk</option></select></div><div><label class="block text-sm font-medium">Judul</label><select id="ticket-judul" class="w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Kategori</option><option>Internet Down</option><option>Internet Slow</option><option>Internet Intermiten</option><option>Internal Customer Problem</option><option>Kendala Deactivated</option><option>Double Ticket</option><option>Optional</option></select></div><div><label class="block text-sm font-medium">Deskripsi</label><textarea id="ticket-deskripsi" rows="4" class="w-full px-4 py-2 border rounded-lg" required></textarea></div><div><label class="block text-sm font-medium">Lampiran</label><input type="file" id="ticket-file" class="w-full"><p id="ticket-upload-status" class="text-sm mt-2"></p></div><button type="submit" class="w-full bg-blue-500 text-white font-bold py-3 rounded-lg">Submit</button></form></div>

            <!-- Laporan Ticket -->
            <div id="view-laporan-ticket" class="content-view hidden"><h2 class="text-3xl font-bold mb-6">Laporan Ticket</h2><div class="bg-white p-4 rounded-lg shadow-md mb-6 flex gap-4 items-end"><div class="w-full"><label class="block text-sm">Dari</label><input type="date" id="export-start-tickets" class="w-full border rounded px-3 py-2" onchange="applyFilter('tickets')"></div><div class="w-full"><label class="block text-sm">Sampai</label><input type="date" id="export-end-tickets" class="w-full border rounded px-3 py-2" onchange="applyFilter('tickets')"></div><div class="w-full"><label class="block text-sm">Branch</label><select id="export-branch-tickets" class="w-full border rounded px-3 py-2" onchange="applyFilter('tickets')"><option value="">Semua Branch</option></select></div><button onclick="handleExport('tickets')" class="bg-green-600 text-white font-bold py-2 px-6 rounded">Excel</button></div><div class="flex justify-between mb-4"><div class="flex items-center"><label class="mr-2">Show</label><select onchange="changePageSize('tickets',this.value)" class="border rounded"><option>5</option><option>10</option><option>25</option></select></div><div><button onclick="changePage('tickets',-1)" class="px-3 bg-gray-200 rounded">Prev</button><span id="page-indicator-tickets" class="mx-2">Page 1</span><button onclick="changePage('tickets',1)" class="px-3 bg-gray-200 rounded">Next</button></div></div><div class="bg-white rounded-lg shadow overflow-x-auto"><table class="w-full table-auto"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left">No Ticket</th><th class="px-6 py-3 text-left">Branch</th><th class="px-6 py-3 text-left">Judul</th><th class="px-6 py-3 text-left">Deskripsi</th><th class="px-6 py-3 text-left">Lampiran</th><th class="px-6 py-3 text-left">Status</th><th class="px-6 py-3 text-left">Tanggal</th><th class="px-6 py-3 text-left">Aksi</th></tr></thead><tbody id="report-container-ticket"></tbody></table></div></div>

            <!-- Maintenance -->
            <div id="view-maintenance" class="content-view hidden"><h2 class="text-3xl font-bold mb-6">Input & Laporan Maintenance</h2><form id="form-maintenance" class="bg-white p-8 rounded-lg shadow-md mb-8 space-y-6"><div><label class="block text-sm font-medium">Branch</label><select id="maintenance-branch" class="w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Branch</option><option>Branch Ciracas</option><option>Branch Cawang</option><option>Branch Duren Sawit</option><option>Branch Rawamangun</option><option>Branch Ujung Menteng</option><option>Branch Pondok Kopi</option><option>Branch Sunter</option><option>Branch Pademangan</option><option>Branch PLuit</option><option>Branch Kelapa Gading</option><option>Branch Tanjung Priuk</option></select></div><input type="text" id="maintenance-judul" placeholder="Judul" class="w-full px-4 py-2 border rounded-lg" required><textarea id="maintenance-deskripsi" rows="4" placeholder="Deskripsi" class="w-full px-4 py-2 border rounded-lg" required></textarea><button type="submit" class="w-full bg-teal-500 text-white font-bold py-3 rounded-lg">Submit</button></form><div class="bg-white p-4 rounded-lg shadow-md mb-6 flex gap-4 items-end"><div class="w-full"><label class="block text-sm">Dari</label><input type="date" id="export-start-maintenance" class="w-full border rounded px-3 py-2" onchange="applyFilter('maintenance')"></div><div class="w-full"><label class="block text-sm">Sampai</label><input type="date" id="export-end-maintenance" class="w-full border rounded px-3 py-2" onchange="applyFilter('maintenance')"></div><div class="w-full"><label class="block text-sm">Branch</label><select id="export-branch-maintenance" class="w-full border rounded px-3 py-2" onchange="applyFilter('maintenance')"><option value="">Semua Branch</option></select></div><button onclick="handleExport('maintenance')" class="bg-green-600 text-white font-bold py-2 px-6 rounded">Excel</button></div><div class="flex justify-between mb-4"><div><select onchange="changePageSize('maintenance',this.value)" class="border rounded"><option>5</option><option>10</option></select></div><div><button onclick="changePage('maintenance',-1)" class="px-3 bg-gray-200 rounded">Prev</button><span id="page-indicator-maintenance" class="mx-2">Page 1</span><button onclick="changePage('maintenance',1)" class="px-3 bg-gray-200 rounded">Next</button></div></div><div class="bg-white rounded-lg shadow overflow-x-auto"><table class="w-full table-auto"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left">Branch</th><th class="px-6 py-3 text-left">Judul</th><th class="px-6 py-3 text-left">Deskripsi</th><th class="px-6 py-3 text-left">Tanggal</th></tr></thead><tbody id="report-container-maintenance"></tbody></table></div></div>

            <!-- Konfirm Customer -->
            <div id="view-konfirm-customer" class="content-view hidden"><h2 class="text-3xl font-bold mb-6">Input & Laporan Konfirmasi Customer</h2><form id="form-konfirm-customer" class="bg-white p-8 rounded-lg shadow-md mb-8 space-y-6"><div><label class="block text-sm font-medium">Branch</label><select id="konfirm-branch" class="w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Branch</option><option>Branch Ciracas</option><option>Branch Cawang</option><option>Branch Duren Sawit</option><option>Branch Rawamangun</option><option>Branch Ujung Menteng</option><option>Branch Pondok Kopi</option><option>Branch Sunter</option><option>Branch Pademangan</option><option>Branch PLuit</option><option>Branch Kelapa Gading</option><option>Branch Tanjung Priuk</option></select></div><div><label class="block text-sm font-medium">Tanggal Input</label><input type="date" id="konfirm-tanggal" class="w-full px-4 py-2 border rounded-lg" required></div><div><label class="block text-sm font-medium">Judul</label><select id="konfirm-judul" class="w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Judul</option><option>Internet Down</option><option>Internet Slow</option><option>Internet Intermiten</option><option>Internal Customer Problem</option><option>Kendala Deactivated</option><option>Double Ticket</option><option>Optional</option></select></div><textarea id="konfirm-deskripsi" rows="4" placeholder="Deskripsi" class="w-full px-4 py-2 border rounded-lg" required></textarea><button type="submit" class="w-full bg-green-500 text-white font-bold py-3 rounded-lg">Submit</button></form><div class="bg-white p-4 rounded-lg shadow-md mb-6 flex gap-4 items-end"><div class="w-full"><label class="block text-sm">Dari</label><input type="date" id="export-start-konfirmCustomer" class="w-full border rounded px-3 py-2" onchange="applyFilter('konfirmCustomer')"></div><div class="w-full"><label class="block text-sm">Sampai</label><input type="date" id="export-end-konfirmCustomer" class="w-full border rounded px-3 py-2" onchange="applyFilter('konfirmCustomer')"></div><div class="w-full"><label class="block text-sm">Branch</label><select id="export-branch-konfirmCustomer" class="w-full border rounded px-3 py-2" onchange="applyFilter('konfirmCustomer')"><option value="">Semua Branch</option></select></div><button onclick="handleExport('konfirmCustomer')" class="bg-green-600 text-white font-bold py-2 px-6 rounded">Excel</button></div><div class="flex justify-between mb-4"><div><select onchange="changePageSize('konfirmCustomer',this.value)" class="border rounded"><option>5</option><option>10</option></select></div><div><button onclick="changePage('konfirmCustomer',-1)" class="px-3 bg-gray-200 rounded">Prev</button><span id="page-indicator-konfirmCustomer" class="mx-2">Page 1</span><button onclick="changePage('konfirmCustomer',1)" class="px-3 bg-gray-200 rounded">Next</button></div></div><div class="bg-white rounded-lg shadow overflow-x-auto"><table class="w-full table-auto"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left">Branch</th><th class="px-6 py-3 text-left">Tgl Input</th><th class="px-6 py-3 text-left">Judul</th><th class="px-6 py-3 text-left">Deskripsi</th><th class="px-6 py-3 text-left">Status</th><th class="px-6 py-3 text-left">Dibuat</th><th class="px-6 py-3 text-left">Aksi</th></tr></thead><tbody id="report-container-konfirm-customer"></tbody></table></div></div>

            <!-- Kendala Vendor -->
            <div id="view-kendala-vendor" class="content-view hidden"><h2 class="text-3xl font-bold mb-6">Input & Laporan Kendala Vendor</h2><form id="form-kendala-vendor" class="bg-white p-8 rounded-lg shadow-md mb-8 space-y-6"><div><label class="block text-sm font-medium">Branch</label><select id="kendala-branch" class="w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Branch</option><option>Branch Ciracas</option><option>Branch Cawang</option><option>Branch Duren Sawit</option><option>Branch Rawamangun</option><option>Branch Ujung Menteng</option><option>Branch Pondok Kopi</option><option>Branch Sunter</option><option>Branch Pademangan</option><option>Branch PLuit</option><option>Branch Kelapa Gading</option><option>Branch Tanjung Priuk</option></select></div><input type="text" id="kendala-judul" placeholder="Judul" class="w-full px-4 py-2 border rounded-lg" required><textarea id="kendala-deskripsi" rows="4" placeholder="Deskripsi" class="w-full px-4 py-2 border rounded-lg" required></textarea><button type="submit" class="w-full bg-yellow-500 text-white font-bold py-3 rounded-lg">Submit</button></form><div class="bg-white p-4 rounded-lg shadow-md mb-6 flex gap-4 items-end"><div class="w-full"><label class="block text-sm">Dari</label><input type="date" id="export-start-kendalaVendor" class="w-full border rounded px-3 py-2" onchange="applyFilter('kendalaVendor')"></div><div class="w-full"><label class="block text-sm">Sampai</label><input type="date" id="export-end-kendalaVendor" class="w-full border rounded px-3 py-2" onchange="applyFilter('kendalaVendor')"></div><div class="w-full"><label class="block text-sm">Branch</label><select id="export-branch-kendalaVendor" class="w-full border rounded px-3 py-2" onchange="applyFilter('kendalaVendor')"><option value="">Semua Branch</option></select></div><button onclick="handleExport('kendalaVendor')" class="bg-green-600 text-white font-bold py-2 px-6 rounded">Excel</button></div><div class="flex justify-between mb-4"><div><select onchange="changePageSize('kendalaVendor',this.value)" class="border rounded"><option>5</option><option>10</option></select></div><div><button onclick="changePage('kendalaVendor',-1)" class="px-3 bg-gray-200 rounded">Prev</button><span id="page-indicator-kendalaVendor" class="mx-2">Page 1</span><button onclick="changePage('kendalaVendor',1)" class="px-3 bg-gray-200 rounded">Next</button></div></div><div class="bg-white rounded-lg shadow overflow-x-auto"><table class="w-full table-auto"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left">Branch</th><th class="px-6 py-3 text-left">Judul</th><th class="px-6 py-3 text-left">Deskripsi</th><th class="px-6 py-3 text-left">Tanggal</th><th class="px-6 py-3 text-left">Aksi</th></tr></thead><tbody id="report-container-kendala-vendor"></tbody></table></div></div>

            <!-- Absensi -->
            <div id="view-absensi" class="content-view hidden"><h2 class="text-3xl font-bold mb-6">Input & Laporan Absensi</h2><form id="form-absensi" class="bg-white p-8 rounded-lg shadow-md mb-8 space-y-6"><div><label class="block text-sm font-medium">Branch</label><select id="absensi-branch" class="w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Branch</option><option>Branch Ciracas</option><option>Branch Cawang</option><option>Branch Duren Sawit</option><option>Branch Rawamangun</option><option>Branch Ujung Menteng</option><option>Branch Pondok Kopi</option><option>Branch Sunter</option><option>Branch Pademangan</option><option>Branch PLuit</option><option>Branch Kelapa Gading</option><option>Branch Tanjung Priuk</option></select></div><div><label class="block text-sm font-medium">Keterangan</label><select id="absensi-keterangan" class="w-full px-4 py-2 border rounded-lg" required><option>Hadir</option><option>Sakit</option><option>Izin</option><option>Alpha</option></select></div><textarea id="absensi-deskripsi" rows="4" placeholder="Deskripsi" class="w-full px-4 py-2 border rounded-lg"></textarea><button type="submit" class="w-full bg-indigo-500 text-white font-bold py-3 rounded-lg">Submit</button></form><div class="bg-white p-4 rounded-lg shadow-md mb-6 flex gap-4 items-end"><div class="w-full"><label class="block text-sm">Dari</label><input type="date" id="export-start-absensi" class="w-full border rounded px-3 py-2" onchange="applyFilter('absensi')"></div><div class="w-full"><label class="block text-sm">Sampai</label><input type="date" id="export-end-absensi" class="w-full border rounded px-3 py-2" onchange="applyFilter('absensi')"></div><div class="w-full"><label class="block text-sm">Branch</label><select id="export-branch-absensi" class="w-full border rounded px-3 py-2" onchange="applyFilter('absensi')"><option value="">Semua Branch</option></select></div><button onclick="handleExport('absensi')" class="bg-green-600 text-white font-bold py-2 px-6 rounded">Excel</button></div><div class="flex justify-between mb-4"><div><select onchange="changePageSize('absensi',this.value)" class="border rounded"><option>5</option><option>10</option></select></div><div><button onclick="changePage('absensi',-1)" class="px-3 bg-gray-200 rounded">Prev</button><span id="page-indicator-absensi" class="mx-2">Page 1</span><button onclick="changePage('absensi',1)" class="px-3 bg-gray-200 rounded">Next</button></div></div><div class="bg-white rounded-lg shadow overflow-x-auto"><table class="w-full table-auto"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left">Branch</th><th class="px-6 py-3 text-left">Keterangan</th><th class="px-6 py-3 text-left">Deskripsi</th><th class="px-6 py-3 text-left">Tanggal</th><th class="px-6 py-3 text-left">Aksi</th></tr></thead><tbody id="report-container-absensi"></tbody></table></div></div>

            <!-- Tools -->
            <div id="view-tools" class="content-view hidden"><h2 class="text-3xl font-bold mb-6">Input & Laporan Tools</h2><form id="form-tools" class="bg-white p-8 rounded-lg shadow-md mb-8 space-y-6"><div><label class="block text-sm font-medium">Branch</label><select id="tools-branch" class="w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Branch</option><option>Branch Ciracas</option><option>Branch Cawang</option><option>Branch Duren Sawit</option><option>Branch Rawamangun</option><option>Branch Ujung Menteng</option><option>Branch Pondok Kopi</option><option>Branch Sunter</option><option>Branch Pademangan</option><option>Branch PLuit</option><option>Branch Kelapa Gading</option><option>Branch Tanjung Priuk</option></select></div><input type="text" id="tools-nama" placeholder="Nama Tool" class="w-full px-4 py-2 border rounded-lg" required><textarea id="tools-deskripsi" rows="4" placeholder="Deskripsi" class="w-full px-4 py-2 border rounded-lg" required></textarea><button type="submit" class="w-full bg-purple-500 text-white font-bold py-3 rounded-lg">Submit</button></form><div class="bg-white p-4 rounded-lg shadow-md mb-6 flex gap-4 items-end"><div class="w-full"><label class="block text-sm">Dari</label><input type="date" id="export-start-tools" class="w-full border rounded px-3 py-2" onchange="applyFilter('tools')"></div><div class="w-full"><label class="block text-sm">Sampai</label><input type="date" id="export-end-tools" class="w-full border rounded px-3 py-2" onchange="applyFilter('tools')"></div><div class="w-full"><label class="block text-sm">Branch</label><select id="export-branch-tools" class="w-full border rounded px-3 py-2" onchange="applyFilter('tools')"><option value="">Semua Branch</option></select></div><button onclick="handleExport('tools')" class="bg-green-600 text-white font-bold py-2 px-6 rounded">Excel</button></div><div class="flex justify-between mb-4"><div><select onchange="changePageSize('tools',this.value)" class="border rounded"><option>5</option><option>10</option></select></div><div><button onclick="changePage('tools',-1)" class="px-3 bg-gray-200 rounded">Prev</button><span id="page-indicator-tools" class="mx-2">Page 1</span><button onclick="changePage('tools',1)" class="px-3 bg-gray-200 rounded">Next</button></div></div><div class="bg-white rounded-lg shadow overflow-x-auto"><table class="w-full table-auto"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left">Branch</th><th class="px-6 py-3 text-left">Nama Tool</th><th class="px-6 py-3 text-left">Deskripsi</th><th class="px-6 py-3 text-left">Tanggal</th><th class="px-6 py-3 text-left">Aksi</th></tr></thead><tbody id="report-container-tools"></tbody></table></div></div>

            <!-- Cuty -->
            <div id="view-cuty" class="content-view hidden"><h2 class="text-3xl font-bold mb-6">Input & Laporan Cuti</h2><form id="form-cuty" class="bg-white p-8 rounded-lg shadow-md mb-8 space-y-6"><div><label class="block text-sm font-medium">Branch</label><select id="cuty-branch" class="w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Branch</option><option>Branch Ciracas</option><option>Branch Cawang</option><option>Branch Duren Sawit</option><option>Branch Rawamangun</option><option>Branch Ujung Menteng</option><option>Branch Pondok Kopi</option><option>Branch Sunter</option><option>Branch Pademangan</option><option>Branch PLuit</option><option>Branch Kelapa Gading</option><option>Branch Tanjung Priuk</option></select></div><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm">Mulai</label><input type="date" id="cuty-mulai" class="w-full px-4 py-2 border rounded-lg" required></div><div><label class="block text-sm">Selesai</label><input type="date" id="cuty-selesai" class="w-full px-4 py-2 border rounded-lg" required></div></div><textarea id="cuty-alasan" rows="4" placeholder="Alasan" class="w-full px-4 py-2 border rounded-lg" required></textarea><button type="submit" class="w-full bg-pink-500 text-white font-bold py-3 rounded-lg">Submit</button></form><div class="bg-white p-4 rounded-lg shadow-md mb-6 flex gap-4 items-end"><div class="w-full"><label class="block text-sm">Dari</label><input type="date" id="export-start-cuty" class="w-full border rounded px-3 py-2" onchange="applyFilter('cuty')"></div><div class="w-full"><label class="block text-sm">Sampai</label><input type="date" id="export-end-cuty" class="w-full border rounded px-3 py-2" onchange="applyFilter('cuty')"></div><div class="w-full"><label class="block text-sm">Branch</label><select id="export-branch-cuty" class="w-full border rounded px-3 py-2" onchange="applyFilter('cuty')"><option value="">Semua Branch</option></select></div><button onclick="handleExport('cuty')" class="bg-green-600 text-white font-bold py-2 px-6 rounded">Excel</button></div><div class="flex justify-between mb-4"><div><select onchange="changePageSize('cuty',this.value)" class="border rounded"><option>5</option><option>10</option></select></div><div><button onclick="changePage('cuty',-1)" class="px-3 bg-gray-200 rounded">Prev</button><span id="page-indicator-cuty" class="mx-2">Page 1</span><button onclick="changePage('cuty',1)" class="px-3 bg-gray-200 rounded">Next</button></div></div><div class="bg-white rounded-lg shadow overflow-x-auto"><table class="w-full table-auto"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left">Branch</th><th class="px-6 py-3 text-left">Mulai</th><th class="px-6 py-3 text-left">Selesai</th><th class="px-6 py-3 text-left">Alasan</th><th class="px-6 py-3 text-left">Tanggal</th><th class="px-6 py-3 text-left">Aksi</th></tr></thead><tbody id="report-container-cuty"></tbody></table></div></div>

            <!-- Optional -->
            <div id="view-optional" class="content-view hidden"><h2 class="text-3xl font-bold mb-6">Input & Laporan Optional</h2><form id="form-optional" class="bg-white p-8 rounded-lg shadow-md mb-8 space-y-6"><div><label class="block text-sm font-medium">Branch</label><select id="optional-branch" class="w-full px-4 py-2 border rounded-lg" required><option value="" disabled selected>Pilih Branch</option><option>Branch Ciracas</option><option>Branch Cawang</option><option>Branch Duren Sawit</option><option>Branch Rawamangun</option><option>Branch Ujung Menteng</option><option>Branch Pondok Kopi</option><option>Branch Sunter</option><option>Branch Pademangan</option><option>Branch PLuit</option><option>Branch Kelapa Gading</option><option>Branch Tanjung Priuk</option></select></div><input type="text" id="optional-judul" placeholder="Judul" class="w-full px-4 py-2 border rounded-lg" required><textarea id="optional-deskripsi" rows="4" placeholder="Deskripsi" class="w-full px-4 py-2 border rounded-lg" required></textarea><button type="submit" class="w-full bg-gray-500 text-white font-bold py-3 rounded-lg">Submit</button></form><div class="bg-white p-4 rounded-lg shadow-md mb-6 flex gap-4 items-end"><div class="w-full"><label class="block text-sm">Dari</label><input type="date" id="export-start-optional" class="w-full border rounded px-3 py-2" onchange="applyFilter('optional')"></div><div class="w-full"><label class="block text-sm">Sampai</label><input type="date" id="export-end-optional" class="w-full border rounded px-3 py-2" onchange="applyFilter('optional')"></div><div class="w-full"><label class="block text-sm">Branch</label><select id="export-branch-optional" class="w-full border rounded px-3 py-2" onchange="applyFilter('optional')"><option value="">Semua Branch</option></select></div><button onclick="handleExport('optional')" class="bg-green-600 text-white font-bold py-2 px-6 rounded">Excel</button></div><div class="flex justify-between mb-4"><div><select onchange="changePageSize('optional',this.value)" class="border rounded"><option>5</option><option>10</option></select></div><div><button onclick="changePage('optional',-1)" class="px-3 bg-gray-200 rounded">Prev</button><span id="page-indicator-optional" class="mx-2">Page 1</span><button onclick="changePage('optional',1)" class="px-3 bg-gray-200 rounded">Next</button></div></div><div class="bg-white rounded-lg shadow overflow-x-auto"><table class="w-full table-auto"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left">Branch</th><th class="px-6 py-3 text-left">Judul</th><th class="px-6 py-3 text-left">Deskripsi</th><th class="px-6 py-3 text-left">Tanggal</th><th class="px-6 py-3 text-left">Aksi</th></tr></thead><tbody id="report-container-optional"></tbody></table></div></div>
        </main>
    </div>

    <!-- Modals -->
    <div id="alert-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center"><div class="relative p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3 text-center"><h3 class="text-lg font-medium" id="alert-title"></h3><div class="mt-2 px-7 py-3"><p class="text-sm text-gray-500" id="alert-message"></p></div><div class="px-4 py-3"><button id="alert-ok-button" class="px-4 py-2 bg-blue-500 text-white rounded-md w-full">OK</button></div></div></div></div>
    <div id="confirm-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center"><div class="relative p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3 text-center"><h3 class="text-lg font-medium text-red-600">Konfirmasi</h3><div class="mt-2 px-7 py-3"><p class="text-sm text-gray-500">Hapus data ini?</p></div><div class="flex gap-4 px-4 py-3 justify-center"><button id="confirm-cancel-button" class="px-4 py-2 bg-gray-300 rounded-md">Batal</button><button id="confirm-delete-button" class="px-4 py-2 bg-red-600 text-white rounded-md">Hapus</button></div></div></div></div>
    <div id="edit-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full z-50 flex items-center justify-center"><div class="relative bg-white rounded-lg shadow-xl w-full max-w-lg mx-4"><div class="px-6 py-4 border-b flex justify-between"><h3 class="text-lg font-bold">Edit Data</h3><button onclick="closeEditModal()">x</button></div><div class="p-6 space-y-4" id="edit-modal-content"></div><div class="px-6 py-4 bg-gray-50 flex justify-end gap-3"><button onclick="closeEditModal()" class="px-4 py-2 border rounded-lg">Batal</button><button id="save-edit-button" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Simpan</button></div></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, signInWithCustomToken, setPersistence, inMemoryPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, Timestamp, setLogLevel, deleteDoc, updateDoc, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // Config & Init
        const firebaseConfig = { apiKey: "AIzaSyAsHgpBDdNRIWnAAV7X8mxaF7C23KsOgsg", authDomain: "report-netop-jak-5.firebaseapp.com", projectId: "report-netop-jak-5", storageBucket: "report-netop-jak-5.firebasestorage.app", messagingSenderId: "254034468445", appId: "1:254034468445:web:e2b24dd61fae05a13df7b4", measurementId: "G-ERDCLK8NEN" };
        const appId = firebaseConfig.projectId;
        const app = initializeApp(firebaseConfig), auth = getAuth(app), db = getFirestore(app), storage = getStorage(app);
        setLogLevel('Debug');

        let userId = null, unsubscribeListeners = [], itemToDelete = null, itemToEdit = null;
        window.appData = {};
        window.paginationState = { tickets: {page:1,limit:5}, maintenance: {page:1,limit:5}, konfirmCustomer: {page:1,limit:5}, kendalaVendor: {page:1,limit:5}, absensi: {page:1,limit:5}, tools: {page:1,limit:5}, cuty: {page:1,limit:5}, optional: {page:1,limit:5} };

        // DOM & Alert
        const loginContainer=document.getElementById('login-container'), pinContainer=document.getElementById('pin-container'), appContainer=document.getElementById('app-container'), alertModal=document.getElementById('alert-modal'), confirmModal=document.getElementById('confirm-modal'), editModal=document.getElementById('edit-modal');
        function showAlert(msg, title="Notifikasi") { document.getElementById('alert-title').innerText=title; document.getElementById('alert-message').innerText=msg; alertModal.classList.remove('hidden'); }
        document.getElementById('alert-ok-button').onclick = () => alertModal.classList.add('hidden');

        // Auth & PIN
        document.getElementById('pin-form').onsubmit = (e) => { e.preventDefault(); if(document.getElementById('pin-input').value==="122025"){ sessionStorage.setItem('pin_verified','true'); pinContainer.classList.add('hidden'); appContainer.classList.remove('hidden'); initApp(); } else { document.getElementById('pin-error').classList.remove('hidden'); } };
        document.getElementById('pin-logout-btn').onclick = async()=>{ await signOut(auth); pinContainer.classList.add('hidden'); loginContainer.classList.remove('hidden'); sessionStorage.removeItem('pin_verified'); };
        onAuthStateChanged(auth, (user) => { if(user){ userId=user.uid; loginContainer.classList.add('hidden'); if(sessionStorage.getItem('pin_verified')==='true'){ appContainer.classList.remove('hidden'); initApp(); } else { pinContainer.classList.remove('hidden'); } } else { userId=null; loginContainer.classList.remove('hidden'); appContainer.classList.add('hidden'); pinContainer.classList.add('hidden'); stopFirestoreListeners(); } });
        document.getElementById('login-form').onsubmit = async(e)=>{e.preventDefault(); try{await signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-password').value);}catch(e){showAlert(e.message);}};
        document.getElementById('logout-button').onclick = ()=>{sessionStorage.removeItem('pin_verified'); signOut(auth);};

        // Navigation
        window.navigateTo = function(v){ document.querySelectorAll('.sidebar-link').forEach(l=>{l.classList.remove('active','bg-blue-700'); if(l.dataset.view===v)l.classList.add('active','bg-blue-700');}); document.querySelectorAll('.content-view').forEach(c=>c.classList.add('hidden')); document.getElementById(`view-${v}`).classList.remove('hidden'); };
        document.querySelectorAll('.sidebar-link').forEach(l=>l.onclick = (e)=>{e.preventDefault(); navigateTo(l.dataset.view);});

        // App Init
        function initApp() {
            if (!userId) return;
            stopFirestoreListeners();
            setupFormAndReport('input-ticket', 'tickets', renderTicketReport, handleSubmitTicket);
            setupFormAndReport('konfirm-customer', 'konfirmCustomer', renderKonfirmCustomerReport, createGenericSubmitHandler('konfirmCustomer'));
            setupFormAndReport('maintenance', 'maintenance', renderMaintenanceReport, handleSubmitMaintenance);
            setupFormAndReport('kendala-vendor', 'kendalaVendor', renderKendalaVendorReport, createGenericSubmitHandler('kendalaVendor'));
            setupFormAndReport('absensi', 'absensi', renderAbsensiReport, createGenericSubmitHandler('absensi'));
            setupFormAndReport('tools', 'tools', renderToolsReport, createGenericSubmitHandler('tools'));
            setupFormAndReport('cuty', 'cuty', renderCutyReport, createGenericSubmitHandler('cuty'));
            setupFormAndReport('optional', 'optional', renderOptionalReport, createGenericSubmitHandler('optional'));
            setupDashboardListeners();
        }

        function stopFirestoreListeners() { unsubscribeListeners.forEach(u=>u()); unsubscribeListeners=[]; }

        function setupFormAndReport(view, col, render, submit) {
            const form = document.getElementById(`form-${view}`);
            if(form) form.onsubmit = (e)=>{e.preventDefault(); submit(e);};
            const cid = view==='input-ticket'?'report-container-ticket':`report-container-${view.replace('input-', '')}`;
            const container = document.getElementById(cid);
            if(container) {
                const q = query(collection(db, `artifacts/${appId}/users/${userId}/${col}`));
                unsubscribeListeners.push(onSnapshot(q, (s) => {
                    const data = []; s.forEach(d => data.push({id: d.id, ...d.data()}));
                    if(data.length>0 && data[0].createdAt) data.sort((a,b)=>b.createdAt.toMillis()-a.createdAt.toMillis());
                    window.appData[col] = data;
                    populateBranchFilter(col, data);
                    refreshTable(col);
                }));
            }
        }

        // Logic Functions
        function populateBranchFilter(col, data) {
            const select = document.getElementById(`export-branch-${col}`);
            if (!select) return;
            const currentVal = select.value;
            const branches = [...new Set(data.map(item => item.branch ? item.branch.trim() : ""))].filter(b => b).sort();
            select.innerHTML = '<option value="">Semua Branch</option>';
            branches.forEach(branch => { const opt = document.createElement('option'); opt.value = branch; opt.textContent = branch; select.appendChild(opt); });
            if (branches.includes(currentVal)) select.value = currentVal;
        }

        window.applyFilter = (col) => { window.paginationState[col].page = 1; refreshTable(col); }
        function getFilteredData(col) {
            const rawData = window.appData[col] || [];
            const startEl = document.getElementById(`export-start-${col}`), endEl = document.getElementById(`export-end-${col}`), branchEl = document.getElementById(`export-branch-${col}`);
            const startVal = startEl ? startEl.value : null, endVal = endEl ? endEl.value : null, branchVal = branchEl ? branchEl.value : null;
            return rawData.filter(item => {
                let valid = true;
                if (item.createdAt) {
                    const date = item.createdAt.toDate(); date.setHours(0,0,0,0);
                    if (startVal && date < new Date(startVal).setHours(0,0,0,0)) valid = false;
                    if (endVal && date > new Date(endVal).setHours(23,59,59,999)) valid = false;
                }
                if (branchVal && branchVal !== "" && (item.branch ? item.branch.trim() : "") !== branchVal) valid = false;
                return valid;
            });
        }

        window.changePageSize = (col, val) => { window.paginationState[col].limit = parseInt(val); window.paginationState[col].page = 1; refreshTable(col); };
        window.changePage = (col, d) => { const data = getFilteredData(col); const s = window.paginationState[col], total = Math.ceil(data.length/s.limit); if(s.page+d > 0 && s.page+d <= total) { s.page += d; refreshTable(col); } };
        function refreshTable(col) { 
            const cid = col==='tickets'?'report-container-ticket':col==='konfirmCustomer'?'report-container-konfirm-customer':col==='kendalaVendor'?'report-container-kendala-vendor':`report-container-${col}`;
            const container = document.getElementById(cid);
            const renderFn = col==='tickets'?renderTicketReport:col==='konfirmCustomer'?renderKonfirmCustomerReport:col==='maintenance'?renderMaintenanceReport:col==='kendalaVendor'?renderKendalaVendorReport:col==='absensi'?renderAbsensiReport:col==='tools'?renderToolsReport:col==='cuty'?renderCutyReport:renderOptionalReport;
            const filteredData = getFilteredData(col);
            const s = window.paginationState[col];
            const start = (s.page - 1) * s.limit; const end = start + s.limit;
            const paginatedData = filteredData.slice(start, end);
            const totalPages = Math.ceil(filteredData.length / s.limit) || 1;
            const indicator = document.getElementById(`page-indicator-${col}`);
            if(indicator) indicator.innerText = `Page ${s.page} of ${totalPages}`;
            renderFn(container, paginatedData);
        }

        window.handleExport = (col) => {
            const data = getFilteredData(col);
            if(data.length === 0) return showAlert("Tidak ada data untuk di-download.");
            const headerMap = { 'createdAt': 'Tanggal Dibuat', 'status': 'Status', 'branch': 'Branch', 'nomer': 'No Ticket', 'judul': 'Judul', 'deskripsi': 'Deskripsi', 'fileUrl': 'Link File', 'tanggal': 'Tgl Input', 'keterangan': 'Keterangan', 'nama': 'Nama Tool', 'mulai': 'Mulai Cuti', 'selesai': 'Selesai Cuti', 'alasan': 'Alasan' };
            const firstItem = data[0];
            const allKeys = Object.keys(firstItem).filter(k => !['id', 'storagePath'].includes(k));
            const orderedKeys = [];
            ['nomer','branch','tanggal','mulai','selesai','judul','nama','keterangan','alasan','deskripsi','status','createdAt','fileUrl'].forEach(k=>{if(allKeys.includes(k))orderedKeys.push(k)});
            let table = `<table border="1"><thead><tr>`;
            orderedKeys.forEach(key => { table += `<th>${headerMap[key] || key.charAt(0).toUpperCase() + key.slice(1)}</th>`; });
            table += `</tr></thead><tbody>`;
            data.forEach(item => {
                table += `<tr>`;
                orderedKeys.forEach(key => {
                    let val = item[key] || '';
                    if (key === 'createdAt' && val && val.toDate) val = val.toDate().toLocaleString('id-ID');
                    else if (key === 'fileUrl' && val) val = `<a href="${val}" target="_blank">Lihat File</a>`;
                    if (typeof val === 'string' && key !== 'fileUrl') val = val.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    table += `<td>${val}</td>`;
                });
                table += `</tr>`;
            });
            table += `</tbody></table>`;
            const blob = new Blob([`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="UTF-8"></head><body>${table}</body></html>`], { type: 'application/vnd.ms-excel' });
            const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = `Laporan_${col}_${new Date().toISOString().slice(0,10)}.xls`; document.body.appendChild(link); link.click(); document.body.removeChild(link);
        };

        // Handlers
        async function handleSubmitTicket(e) { handleGenericSubmit(e, 'tickets', async (form) => { const f=form.querySelector('#ticket-file').files[0]; let u=null; if(f){const r=await uploadBytes(ref(storage,`artifacts/${appId}/users/${userId}/tickets/${Date.now()}_${f.name}`),f);u=await getDownloadURL(r.ref);} return {nomer:form.querySelector('#ticket-nomer').value, branch:form.querySelector('#ticket-branch').value, judul:form.querySelector('#ticket-judul').value, deskripsi:form.querySelector('#ticket-deskripsi').value, status:'Open', fileUrl:u}; }); }
        async function handleSubmitMaintenance(e) { handleGenericSubmit(e, 'maintenance', f => ({branch:f.querySelector('#maintenance-branch').value, judul:f.querySelector('#maintenance-judul').value, deskripsi:f.querySelector('#maintenance-deskripsi').value})); }
        function createGenericSubmitHandler(col) { return (e) => handleGenericSubmit(e, col, f => { const d={status:'Open'}; f.querySelectorAll('input:not([type=file]),textarea,select').forEach(i=>{if(i.id)d[i.id.split('-').slice(1).join('-')]=i.value;}); return d; }); }
        async function handleGenericSubmit(e, col, extractor) { const btn=e.target.querySelector('button[type=submit]'); btn.disabled=true; try{ const d=await extractor(e.target); await addDoc(collection(db,`artifacts/${appId}/users/${userId}/${col}`),{...d,createdAt:Timestamp.now()}); showAlert("Berhasil!"); e.target.reset(); }catch(e){showAlert(e.message);}finally{btn.disabled=false;} }

        function getActionButtons(col, id) { return `<div class="flex space-x-2"><button onclick="openEditModal('${col}','${id}')" class="text-indigo-600">Edit</button><button onclick="confirmDelete('${col}','${id}')" class="text-red-600">Hapus</button></div>`; }
        function renderTicketReport(c, d) { if(d.length===0)return c.innerHTML=`<tr><td colspan="8" class="text-center py-4 text-gray-500">Tidak ada data.</td></tr>`; c.innerHTML=d.map(t=>`<tr class="hover:bg-gray-50"><td class="px-6 py-4 font-semibold">${t.nomer||'-'}</td><td class="px-6 py-4">${t.branch}</td><td class="px-6 py-4">${t.judul}</td><td class="px-6 py-4"><textarea readonly rows="2" class="w-full bg-gray-50 rounded">${t.deskripsi}</textarea></td><td class="px-6 py-4">${t.fileUrl?`<a href="${t.fileUrl}" target="_blank" class="text-blue-500">Lihat</a>`:'-'}</td><td class="px-6 py-4">${t.status||'Open'}</td><td class="px-6 py-4">${t.createdAt?.toDate().toLocaleDateString()}</td><td class="px-6 py-4">${getActionButtons('tickets',t.id)}</td></tr>`).join(''); }
        function renderKonfirmCustomerReport(c, d) { if(d.length===0)return c.innerHTML=`<tr><td colspan="7" class="text-center py-4 text-gray-500">Tidak ada data.</td></tr>`; c.innerHTML=d.map(t=>`<tr class="hover:bg-gray-50"><td class="px-6 py-4">${t.branch}</td><td class="px-6 py-4">${t.tanggal}</td><td class="px-6 py-4">${t.judul}</td><td class="px-6 py-4"><textarea readonly rows="2" class="w-full bg-gray-50 rounded">${t.deskripsi}</textarea></td><td class="px-6 py-4">${t.status||'Open'}</td><td class="px-6 py-4">${t.createdAt?.toDate().toLocaleDateString()}</td><td class="px-6 py-4">${getActionButtons('konfirmCustomer',t.id)}</td></tr>`).join(''); }
        function renderMaintenanceReport(c, d) { if(d.length===0)return c.innerHTML=`<tr><td colspan="5" class="text-center py-4 text-gray-500">Tidak ada data.</td></tr>`; c.innerHTML=d.map(t=>`<tr class="hover:bg-gray-50"><td class="px-6 py-4">${t.branch}</td><td class="px-6 py-4">${t.judul}</td><td class="px-6 py-4">${t.deskripsi}</td><td class="px-6 py-4">${t.createdAt?.toDate().toLocaleDateString()}</td><td class="px-6 py-4">${getActionButtons('maintenance',t.id)}</td></tr>`).join(''); }
        function renderKendalaVendorReport(c, d) { if(d.length===0)return c.innerHTML=`<tr><td colspan="5" class="text-center py-4 text-gray-500">Tidak ada data.</td></tr>`; c.innerHTML=d.map(t=>`<tr class="hover:bg-gray-50"><td class="px-6 py-4">${t.branch}</td><td class="px-6 py-4">${t.judul}</td><td class="px-6 py-4">${t.deskripsi}</td><td class="px-6 py-4">${t.createdAt?.toDate().toLocaleDateString()}</td><td class="px-6 py-4">${getActionButtons('kendalaVendor',t.id)}</td></tr>`).join(''); }
        function renderAbsensiReport(c, d) { if(d.length===0)return c.innerHTML=`<tr><td colspan="5" class="text-center py-4 text-gray-500">Tidak ada data.</td></tr>`; c.innerHTML=d.map(t=>`<tr class="hover:bg-gray-50"><td class="px-6 py-4">${t.branch}</td><td class="px-6 py-4">${t.keterangan}</td><td class="px-6 py-4">${t.deskripsi}</td><td class="px-6 py-4">${t.createdAt?.toDate().toLocaleDateString()}</td><td class="px-6 py-4">${getActionButtons('absensi',t.id)}</td></tr>`).join(''); }
        function renderToolsReport(c, d) { if(d.length===0)return c.innerHTML=`<tr><td colspan="5" class="text-center py-4 text-gray-500">Tidak ada data.</td></tr>`; c.innerHTML=d.map(t=>`<tr class="hover:bg-gray-50"><td class="px-6 py-4">${t.branch}</td><td class="px-6 py-4">${t.nama}</td><td class="px-6 py-4">${t.deskripsi}</td><td class="px-6 py-4">${t.createdAt?.toDate().toLocaleDateString()}</td><td class="px-6 py-4">${getActionButtons('tools',t.id)}</td></tr>`).join(''); }
        function renderCutyReport(c, d) { if(d.length===0)return c.innerHTML=`<tr><td colspan="6" class="text-center py-4 text-gray-500">Tidak ada data.</td></tr>`; c.innerHTML=d.map(t=>`<tr class="hover:bg-gray-50"><td class="px-6 py-4">${t.branch}</td><td class="px-6 py-4">${t.mulai}</td><td class="px-6 py-4">${t.selesai}</td><td class="px-6 py-4">${t.alasan}</td><td class="px-6 py-4">${t.createdAt?.toDate().toLocaleDateString()}</td><td class="px-6 py-4">${getActionButtons('cuty',t.id)}</td></tr>`).join(''); }
        function renderOptionalReport(c, d) { if(d.length===0)return c.innerHTML=`<tr><td colspan="5" class="text-center py-4 text-gray-500">Tidak ada data.</td></tr>`; c.innerHTML=d.map(t=>`<tr class="hover:bg-gray-50"><td class="px-6 py-4">${t.branch}</td><td class="px-6 py-4">${t.judul}</td><td class="px-6 py-4">${t.deskripsi}</td><td class="px-6 py-4">${t.createdAt?.toDate().toLocaleDateString()}</td><td class="px-6 py-4">${getActionButtons('optional',t.id)}</td></tr>`).join(''); }

        function setupDashboardListeners() { if(!userId)return; const map={'tickets':'dashboard-ticket-count','maintenance':'dashboard-maintenance-count','konfirmCustomer':'dashboard-konfirm-count','kendalaVendor':'dashboard-kendala-count','absensi':'dashboard-absensi-count','tools':'dashboard-tools-count','cuty':'dashboard-cuty-count','optional':'dashboard-optional-count'}; for(const[c,i] of Object.entries(map)){ const el=document.getElementById(i); if(el) unsubscribeListeners.push(onSnapshot(query(collection(db,`artifacts/${appId}/users/${userId}/${c}`)), s=>el.innerText=s.size)); } }
        
        window.confirmDelete = function(c,i){itemToDelete={collection:c,id:i};confirmModal.classList.remove('hidden');}
        document.getElementById('confirm-cancel-button').onclick=()=>confirmModal.classList.add('hidden');
        document.getElementById('confirm-delete-button').onclick=async()=>{if(itemToDelete){await deleteDoc(doc(db,`artifacts/${appId}/users/${userId}/${itemToDelete.collection}`,itemToDelete.id));confirmModal.classList.add('hidden');showAlert("Dihapus");}};
        
        window.openEditModal = function(col, id) { const d = window.appData[col].find(i=>i.id===id); if(!d)return; itemToEdit={col,id}; const c=document.getElementById('edit-modal-content'); 
            let html=``;
            // Build dynamic form
            const fields = {
                'tickets': ['nomer', 'judul', 'deskripsi', 'status'],
                'maintenance': ['judul', 'deskripsi'],
                'konfirmCustomer': ['tanggal', 'judul', 'deskripsi', 'status'],
                'kendalaVendor': ['judul', 'deskripsi'],
                'absensi': ['keterangan', 'deskripsi'],
                'tools': ['nama', 'deskripsi'],
                'cuty': ['mulai', 'selesai', 'alasan'],
                'optional': ['judul', 'deskripsi']
            };
            const f = fields[col] || ['judul', 'deskripsi'];
            
            f.forEach(field => {
                if(field === 'status') {
                    html += `Status: <select id="edit-status" class="border p-1 w-full mb-2"><option>Open</option><option>Done</option><option>Reschedule</option></select>`;
                } else if(field === 'deskripsi' || field === 'alasan') {
                    html += `${field.charAt(0).toUpperCase()+field.slice(1)}: <textarea id="edit-${field}" class="border p-1 w-full mb-2">${d[field]||''}</textarea>`;
                } else if(field === 'tanggal' || field === 'mulai' || field === 'selesai') {
                    html += `${field.charAt(0).toUpperCase()+field.slice(1)}: <input type="date" id="edit-${field}" class="border p-1 w-full mb-2" value="${d[field]||''}">`;
                } else {
                    html += `${field.charAt(0).toUpperCase()+field.slice(1)}: <input type="text" id="edit-${field}" class="border p-1 w-full mb-2" value="${d[field]||''}">`;
                }
            });
            c.innerHTML=html; 
            if(d.status && document.getElementById('edit-status')) document.getElementById('edit-status').value = d.status;
            editModal.classList.remove('hidden'); 
        };
        window.closeEditModal = function(){editModal.classList.add('hidden');};
        document.getElementById('save-edit-button').onclick=async()=>{
            if(itemToEdit){
                const updates = {};
                const inputs = document.getElementById('edit-modal-content').querySelectorAll('input, select, textarea');
                inputs.forEach(i => { updates[i.id.replace('edit-', '')] = i.value; });
                await updateDoc(doc(db,`artifacts/${appId}/users/${userId}/${itemToEdit.col}`,itemToEdit.id), updates);
                closeEditModal();showAlert("Tersimpan");
            }
        };
    </script>
</body>
</html>